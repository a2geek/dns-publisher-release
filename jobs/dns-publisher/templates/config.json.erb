<%=

config = {
  "BoshDns" => {
    "Trigger" => {
      "Type" => p("bosh-dns.trigger.type"),
      "FileWatcher" => p("bosh-dns.trigger.file-watcher"),
      "Refresh" => p("bosh-dns.trigger.refresh")
    },
    "Mappings" => [],
  },
  "Publisher" => {}
}

if_p('publisher.options') do
  config['Publisher'] = p("publisher.options")
end
config['Publisher'].merge!({
  "type" => p("publisher.type"),
  "dry-run" => p("publisher.dry-run")
})

if_p("bosh-dns.mappings") do 
  p("bosh-dns.mappings").each do |mapping|
    config["BoshDns"]["Mappings"].push({
      "InstanceGroup" => mapping["instance-group"],
      "Network" => mapping["network"] || "default",
      "Deployment" => mapping["deployment"],
      "TLD" => mapping["tld"] || "bosh",
      "FQDNs" => mapping["fqdns"]
    })
  end
end

JSON.dump(config)

%>